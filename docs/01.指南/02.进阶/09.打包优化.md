---
title: æ‰“åŒ…ä¼˜åŒ–
article: false
date: 2022-11-07
permalink: /pages/buildgood/
---

æ‰“åŒ…ä¼˜åŒ–å…³è”ç€ç½‘ç«™çš„ç¨³å®šä¸åŠ è½½é€Ÿåº¦ï¼Œåœ¨å¼€å‘ä¸­ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ä¸€é¡¹

![img](~@alias/img/watermarks/buildgood.jpg)

## `vite` è‡ªèº«çš„æ„å»ºä¼˜åŒ–

ç‚¹å‡»æŸ¥çœ‹ [build-optimizations](https://cn.vitejs.dev/guide/features.html#build-optimizations) <Badge text="viteå®˜æ–¹æ–‡æ¡£"/>

## `css` ä¼˜åŒ–

åˆ†ä¸¤æ­¥ä¼˜åŒ–

### â€‹ å‹ç¼© `css`

ä½¿ç”¨ [cssnano](/pages/tailwindcss/#cssnano) å»å‹ç¼© `css`

### â€‹ è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€

ä½¿ç”¨ [Autoprefixer](/pages/tailwindcss/#autoprefixer) è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€

## ç»„ä»¶ã€å·¥å…·åº“

- æ— è®ºæ˜¯ç»„ä»¶ï¼ˆå¦‚ `element-plus`ï¼‰ï¼Œè¿˜æ˜¯å·¥å…·åº“ï¼ˆå¦‚ `lodash`ã€`axios`ï¼‰æˆ‘ä»¬éƒ½åº”è¯¥å°½å¯èƒ½çš„æŒ‰éœ€å¼•å…¥ï¼Œä½¿å…¶æœ‰è‰¯å¥½çš„ Â `tree-shaking` æ•ˆæœï¼Œè¿™æ ·é¡¹ç›®æ•´ä½“æ‰“åŒ…å‡ºæ¥çš„æ— ç”¨ä»£ç å°±å°‘ä¹‹åˆå°‘äº†

- æ‹¿ `lodash` ä¸¾ä¾‹ï¼Œ`lodash` é»˜è®¤æ˜¯ `cjs` æ ¼å¼ï¼Œä¸æ”¯æŒ `es6` çš„ `import` è¯­æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å» `github` æˆ–è€…æŸäº›æœç´¢å¼•æ“å»å¯»æ‰¾æ›¿ä»£å“ï¼Œæœ€ç»ˆå¹³å°æ‰¾åˆ°äº† `lodash-unified`ï¼Œå®ƒå®Œå…¨å…¼å®¹ `lodash` çš„å…¨éƒ¨è¯­æ³•å¹¶ä¸”æ—¢æ”¯æŒ `esm` åˆæ”¯æŒ `cjs`ï¼Œè¿™ä½¿å¾—å®ƒæ— è®ºåœ¨æµè§ˆå™¨è¿˜æ˜¯ `node` ç¯å¢ƒä¸­è¡¨ç°éƒ½å¾ˆè‰¯å¥½ã€‚å½“ç„¶å¦‚æœé‡åˆ°é‚£ç§åªæ”¯æŒ `cjs` æ ¼å¼ï¼Œç½‘ä¸Šæ‰¾éäº†éƒ½æ‰¾ä¸åˆ°å…¼å®¹ `esm` æ ¼å¼çš„å’‹åŠå‘¢ï¼Œè¿™æ—¶ä½ å¯ä»¥å‚è€ƒ `lodash-unified`ï¼Œçœ‹çœ‹åˆ«äººæ˜¯å¦‚ä½•è½¬æ¢çš„ ğŸ˜Š

- å¹³å°ç²¾ç®€ç‰ˆé¦–æ¬¡å¯åŠ¨æ—¶é—´æˆ‘è¿™è¾¹æµ‹è¯•æ˜¯ `6` ç§’ï¼Œåˆ·æ–°é¡µé¢çš„è¯å¼€å¯ [CachingAsyncRoutes](https://github.com/pure-admin/vue-pure-admin/blob/main/public/platform-config.json#L23) å¯èƒ½è¿ `1` ç§’éƒ½ä¸è¦ã€‚å¦‚æœæ‚¨ä½¿ç”¨ `pure-admin` ä¸”å½“å‰ç½‘é¡µ`é¦–å¯åŠ¨`å’Œ`åˆ·æ–°é¡µé¢`çš„ç­‰å¾…æ—¶é—´è¿œè¿œå¤§äºå‰é¢çš„æ•°å­—ï¼Œä¹Ÿè¯¥è€ƒè™‘ä¼˜åŒ–äº†ã€‚å½“é¡¹ç›®å…·æœ‰ä¸€å®šè§„æ¨¡çš„æ—¶å€™ï¼Œä¼˜åŒ–å¹¶æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“ï¼Œæ‰€ä»¥æ‚¨åœ¨å†™ä»£ç å‰å°±åº”è¯¥éµå¾ªæˆ‘ä¸Šé¢çš„è¯´æ³•ï¼ŒæŒ‰éœ€å¼•å…¥æ‰æ˜¯ `yyds` ğŸ˜„

<!-- <video width="320" height="240" controls>
  <source :src="$withBase('/video/start.mov')" type="video/mp4">
</video> -->

- `vite` ç›®å‰æœ€å¤§çš„æ€§èƒ½ç“¶é¢ˆæ˜¯å¤§é‡æ¨¡å—çš„é¦–é¡µåŠ è½½ï¼Œå¯çœ‹ [vite-issues](https://github.com/vitejs/vite/issues/1309#issue-777569758)ï¼Œå€¼å¾—æœŸå¾…çš„æ˜¯è¿™ä¸ª [pr](https://github.com/vitejs/vite/pull/10671) å¯èƒ½ä¼šç¼“è§£è¿™ä¸ªéº»çƒ¦

## å‹ç¼© `gzip`ã€`brotli` æ ¼å¼

ä½¿ç”¨ [vite-plugin-compression](https://github.com/vbenjs/vite-plugin-compression) å¯¹å¹³å°è¿›è¡Œ `gzip` æˆ–è€… `brotli` å‹ç¼©ï¼Œ`nginx` å¯¹è¿™ä¸¤ç§å‹ç¼©æ¨¡å¼éƒ½æ”¯æŒï¼Œå‹ç¼©åéƒ¨ç½²åˆ° `nginx` å°†æå¤§æé«˜ç½‘é¡µåŠ è½½é€Ÿåº¦

### å¦‚ä½•å¼€å¯å‹ç¼©

æ¥åˆ° `.env.production` æ–‡ä»¶ï¼Œè®¾ç½® [VITE_COMPRESSION](https://github.com/pure-admin/vue-pure-admin/blob/main/.env.production#L13) å³å¯ã€‚è®¾ç½®æ€»ä½“åˆ†ä¸ºä¸‹é¢ä¸¤ç§ [å…·ä½“å®ç°ä»£ç ](https://github.com/pure-admin/vue-pure-admin/blob/main/build/compress.ts)

#### ä¸¤ç§æ€»ä½“è®¾ç½®

1. å‹ç¼©æ—¶ä¸åˆ é™¤åŸå§‹æ–‡ä»¶çš„é…ç½®
2. å‹ç¼©æ—¶åˆ é™¤åŸå§‹æ–‡ä»¶çš„é…ç½®

##### å‹ç¼©æ—¶ä¸åˆ é™¤åŸå§‹æ–‡ä»¶çš„é…ç½®

```.env.production
å¼€å¯ gzip å‹ç¼©
VITE_COMPRESSION = "gzip"

å¼€å¯ brotli å‹ç¼©
VITE_COMPRESSION = "brotli"

# åŒæ—¶å¼€å¯ gzip ä¸ brotli å‹ç¼©
VITE_COMPRESSION = "both"

# ä¸å¼€å¯å‹ç¼©ï¼Œé»˜è®¤
VITE_COMPRESSION = "none"
```

##### å‹ç¼©æ—¶åˆ é™¤åŸå§‹æ–‡ä»¶çš„é…ç½®

```.env.production
å¼€å¯ gzip å‹ç¼©
VITE_COMPRESSION = "gzip-clear"

å¼€å¯ brotli å‹ç¼©
VITE_COMPRESSION = "brotli-clear"

# åŒæ—¶å¼€å¯ gzip ä¸ brotli å‹ç¼©
VITE_COMPRESSION = "both-clear"

# ä¸å¼€å¯å‹ç¼©ï¼Œé»˜è®¤
VITE_COMPRESSION = "none"
```

## é‡‡ç”¨ `cdn` æ¨¡å¼æ›¿æ¢æœ¬åœ°ä¾èµ–

### `vite` æ’ä»¶

ä½¿ç”¨ [vite-plugin-cdn-import](https://github.com/MMF-FE/vite-plugin-cdn-import/blob/master/README.zh-CN.md) æ’ä»¶ï¼Œåœ¨æ‰“åŒ…æ—¶å°†æŒ‡å®šçš„ `modules` æ›¿æ¢æˆ `cdn` é“¾æ¥ï¼Œä»è€Œå‡å°‘æ„å»ºæ—¶é—´ï¼Œæé«˜ç”Ÿäº§ç¯å¢ƒä¸­é¡µé¢åŠ è½½é€Ÿåº¦ã€‚

### `cdn` å‚å•†ï¼ˆå…è´¹ï¼‰

å¹³å° `cdn` é‡‡ç”¨çš„æ˜¯å›½å†… [bootcdn](https://www.bootcdn.cn)ï¼Œä¸»è¦æ˜¯ç¨³å®šå¹¶ä¸”å¿«ï¼Œå½“ç„¶æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹© [unpkg](https://unpkg.com) æˆ–è€… [jsdelivr](https://www.jsdelivr.com)ï¼Œè¿™ä¸¤ä¸ª `cdn` æ˜¯å›½å¤–çš„

### å¦‚ä½•å¯åŠ¨ `cdn` æ›¿æ¢

æ¥åˆ° `.env.production` æ–‡ä»¶ï¼Œå°† [VITE_CDN](https://github.com/pure-admin/vue-pure-admin/blob/main/.env.production#L8) è®¾ç½®æˆ `true` å³å¯

### é»˜è®¤å¯åŠ¨ `cdn` æ›¿æ¢çš„æ¨¡å—æœ‰å“ªäº›

`vue`ã€`vue-router`ã€`vue-i18n`ã€`vue-demi`ã€`pinia`ã€`element-plus`ã€`axios`ã€`dayjs`ã€`echarts` å…·ä½“ä»£ç  [build/cdn.ts](https://github.com/pure-admin/vue-pure-admin/blob/main/build/cdn.ts)

## ç”Ÿäº§ç¯å¢ƒåˆ é™¤ `console.log`

ä½¿ç”¨å¹³å°å¼€å‘çš„ [vite-plugin-remove-console](https://github.com/xiaoxian521/vite-plugin-remove-console) æ’ä»¶ï¼Œåœ¨æ‰“åŒ…æ„å»ºæ—¶ç§»é™¤å¹³å°ä¸­æ‰€æœ‰çš„ `console.log`

## é™æ€èµ„æºåˆ†ç±»æ‰“åŒ…

`vite` æ˜¯åŸºäº `esbuild` å’Œ `rollup` æ„å»ºçš„ï¼Œåœ¨æ‰“åŒ…æ—¶å¦‚æœä¸è¿›è¡Œ `output` çš„é…ç½®ï¼Œæ‰“åŒ…å‡ºæ¥çš„æ•ˆæœå¦‚ä¸‹å›¾ï¼ˆè¿™ä¹Ÿæ˜¯ `vite` é»˜è®¤æ‰“åŒ…å‡ºæ¥çš„æ•ˆæœï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰æ–‡ä»¶éƒ½æ··åœ¨ä¸€èµ·ï¼‰

![img](~@alias/img/build/no-output.jpg)

ä¸‹å›¾æ˜¯æˆ‘ä»¬é…ç½® [output](https://github.com/pure-admin/vue-pure-admin/blob/main/vite.config.ts#L50-L54) åçš„æ•ˆæœï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶éƒ½è¿›è¡Œäº†åˆ†ç±»å­˜æ”¾ï¼Œè¿™ä¹Ÿæ–¹ä¾¿æˆ‘ä»¬æŸ¥æ‰¾æ–‡ä»¶

![img](~@alias/img/build/output.jpg)

:::tip ç›¸å…³æ¨è
[Vite ä»£ç æ‹†åŒ…æ’ä»¶ã€‚æ”¯æŒå¤šç§æ‹†åŒ…ç­–ç•¥ï¼Œå¯é¿å…æ‰‹åŠ¨æ“ä½œ manualChunks æ½œåœ¨çš„å¾ªç¯ä¾èµ–é—®é¢˜](https://github.com/sanyuan0704/vite-plugin-chunk-split/blob/master/README-CN.md)
:::

## `svg` å‹ç¼©

ä¸€èˆ¬ä¸‹è½½çš„ `svg` æˆ–è€…å¤åˆ¶çš„ `svg` ä»£ç ï¼Œé‡Œé¢å­˜åœ¨ä¸€äº›æ— å…³ç´§è¦çš„å…ƒç´ ï¼Œå¯ä»¥å°†å…¶å‰”é™¤ï¼Œæ¯«æ— å½±å“åœ°é™ä½ `svg` å¤§å°  
å¹³å°ä½¿ç”¨äº† [svgo](https://www.npmjs.com/package/svgo) å·¥å…·å¯¹æ‰€æœ‰ `svg` è¿›è¡Œäº†å‹ç¼©ï¼Œæ‚¨æ‹‰å–å¹³å°ä»£ç æ—¶æ‰€æœ‰ `svg` éƒ½å·²ç»æœ€ç®€äº†å“¦ã€‚å½“ç„¶æ‚¨ä¼šé—®è‡ªå·±æ–°åŠ çš„ `svg` å¦‚ä½•ç²¾ç®€å‘¢ï¼Œæ¥åˆ° [main/package.json](https://github.com/pure-admin/vue-pure-admin/blob/main/package.json#L15)ï¼Œå¯ä»¥çœ‹åˆ°å¹³å°é»˜è®¤ä½¿ç”¨ `svgo` å·¥å…·å¯¹æ‰€æœ‰ `.svg` æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚  
æ¸©é¦¨æç¤ºï¼šåªéœ€è¦è¿è¡Œ `pnpm svgo` å‘½ä»¤å³å¯å¯¹æ‰€æœ‰ `.svg` æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚

:::tip æ¨èé˜…è¯»

- [æ€§èƒ½ä¼˜åŒ–](https://cn.vuejs.org/guide/best-practices/performance.html) <Badge text="vueæ–‡æ¡£"/>
- [Vite ä¸­ç»„ä»¶æŒ‰ç»„åˆ†å—æ‰“åŒ…](https://router.vuejs.org/zh/guide/advanced/lazy-loading.html#%E4%BD%BF%E7%94%A8-vite) <Badge text="vue-routeræ–‡æ¡£"/>
  :::
